#!/usr/bin/env bash
# https://blog.meain.io/2020/tmux-flating-scratch-terminal/
# https://github.com/tmux/tmux/wiki/Formats

command=${1}
[ -z "$command" ] && command="scratch"
session_path=$(tmux display-message -p -F "#{session_path}")
session_path=$(basename "$session_path" | tr . _)

popup_session_name="${session_path}__popup__"${command}""
current_session_name="$(tmux display-message -p -F "#{session_name}")"

if [[ "${current_session_name}" =~ .*_popup_.* ]]; then
    tmux detach-client
fi

if [ "${current_session_name}" != "${popup_session_name}" ]; then
    tmux popup -w "90%" -h "90%" -E "tmux attach -t ${popup_session_name} || tmux new  -s ${popup_session_name} ${@:1}"
fi
